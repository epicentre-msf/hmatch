---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "##",
  fig.path = "man/figures/"
)
options(digits = 4, width = 160)
```

# hmatch: Tools for cleaning and matching hierarchically-structured data
<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

An R package for cleaning and matching messy hierarchical data (e.g. hierarchically-nested adminstrative districts).



## Installation

Install from GitHub with:

```{r, eval=FALSE}
# install.packages("remotes")
remotes::install_github("epicentre-msf/hmatch")
```

### Usage

```{r}
library(hmatch)

# example datasets
data(drc_raw)
data(drc_ref)
```


#### Generate unique codes for each level in a reference dataset

Functions `hcodes_int()` and `hcodes_str()` can be used to create integer- or string-based codes, respectively.

```{r}
drc_ref$hcode <- hcodes_int(drc_ref, pattern = "^adm")
drc_ref
```

#### Match messy hierarchically-structured data to a reference dataset

##### Exact matching

Each hierarchical level must match in sequence.

```{r}
hmatch_exact(drc_raw, drc_ref, type = "inner")
```

##### Partial matching

Allows for missing values at one or more level below the match level.

```{r}
hmatch_partial(drc_raw, drc_ref, type = "inner")
```

##### Partial + fuzzy matching

Partial matching + fuzzy matching based on the [stringdist](https://github.com/markvanderloo/stringdist) package.

```{r}
hmatch_partial(drc_raw, drc_ref, type = "inner", fuzzy = TRUE, max_dist = 2)
```

##### Manual matching

Manually-specified corrections, linking sets of hierarchical levels in the raw data to a corresponding code column in the reference data.

```{r}
drc_man <- data.frame(adm1 = NA_character_,
                      adm2 = NA_character_,
                      adm3 = NA_character_,
                      adm4 = "matanda_ngule",
                      hcode = "1122",
                      stringsAsFactors = FALSE)

hmatch_manual(drc_raw, drc_ref, drc_man, code_col = "hcode", type = "inner")
```

##### Best-possible matching

Find the best-possible match (i.e. highest resolution), using a variety of matching strategies implemented in turn.

```{r}
hmatch_best(raw = drc_raw, ref = drc_ref, man = drc_man, code_col = "hcode")
```
