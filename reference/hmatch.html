<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Match sets of hierarchical values (e.g. province, county, township) in a raw,
messy dataset to corresponding values within a reference dataset, optionally
accounting for discrepancies between the datasets such as:
variation in character case, use of accents, or spelling
variation in hierarchical resolution (e.g. some entries specified to
municipality but others only to region)
missing values at one or more hierarchical levels

"><title>Match sets of hierarchical variables between a raw and reference dataset — hmatch • hmatch</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Match sets of hierarchical variables between a raw and reference dataset — hmatch"><meta property="og:description" content="Match sets of hierarchical values (e.g. province, county, township) in a raw,
messy dataset to corresponding values within a reference dataset, optionally
accounting for discrepancies between the datasets such as:
variation in character case, use of accents, or spelling
variation in hierarchical resolution (e.g. some entries specified to
municipality but others only to region)
missing values at one or more hierarchical levels

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hmatch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epicentre-msf/hmatch/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Match sets of hierarchical variables between a raw and reference dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/epicentre-msf/hmatch/blob/HEAD/R/hmatch.R" class="external-link"><code>R/hmatch.R</code></a></small>
      <div class="d-none name"><code>hmatch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Match sets of hierarchical values (e.g. province, county, township) in a raw,
messy dataset to corresponding values within a reference dataset, optionally
accounting for discrepancies between the datasets such as:</p><ul><li><p>variation in character case, use of accents, or spelling</p></li>
<li><p>variation in hierarchical resolution (e.g. some entries specified to
municipality but others only to region)</p></li>
<li><p>missing values at one or more hierarchical levels</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hmatch</span><span class="op">(</span></span>
<span>  <span class="va">raw</span>,</span>
<span>  <span class="va">ref</span>,</span>
<span>  <span class="va">pattern</span>,</span>
<span>  pattern_ref <span class="op">=</span> <span class="va">pattern</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  by_ref <span class="op">=</span> <span class="va">by</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>  allow_gaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fuzzy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fuzzy_method <span class="op">=</span> <span class="st">"osa"</span>,</span>
<span>  fuzzy_dist <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_prefix <span class="op">=</span> <span class="st">"ref_"</span>,</span>
<span>  std_fn <span class="op">=</span> <span class="va">string_std</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>raw</dt>
<dd><p>data frame containing hierarchical columns with raw data</p></dd>


<dt>ref</dt>
<dd><p>data frame containing hierarchical columns with reference data</p></dd>


<dt>pattern</dt>
<dd><p>regex pattern to match the hierarchical columns in <code>raw</code><br></p>
<p><strong>Note:</strong> hierarchical column names can be matched using either the <code>pattern</code>
<em>or</em> <code>by</code> arguments. Or, if neither <code>pattern</code> or <code>by</code> are specified, the
hierarchical columns are assumed to be all column names that are common to
both <code>raw</code> and <code>ref</code>. See <a href="specifying_columns.html">specifying_columns</a>.</p></dd>


<dt>pattern_ref</dt>
<dd><p>regex pattern to match the hierarchical columns in <code>ref</code>.
Defaults to <code>pattern</code>, so only need to specify if the hierarchical columns
have different names in <code>raw</code> and <code>ref</code>.</p></dd>


<dt>by</dt>
<dd><p>vector giving the names of the hierarchical columns in <code>raw</code></p></dd>


<dt>by_ref</dt>
<dd><p>vector giving the names of the hierarchical columns in <code>ref</code>.
Defaults to <code>by</code>, so only need to specify if the hierarchical columns
have different names in <code>raw</code> and <code>ref</code>.</p></dd>


<dt>type</dt>
<dd><p>type of join ("left", "inner", "anti", "resolve_left",
"resolve_inner", or "resolve_anti"). Defaults to "left". See
<a href="join_types.html">join_types</a>.</p></dd>


<dt>allow_gaps</dt>
<dd><p>logical indicating whether to allow missing values below
the match level, where 'match level' is the highest level with a
non-missing value within a given row of <code>raw</code>. Defaults to <code>TRUE</code>.</p></dd>


<dt>fuzzy</dt>
<dd><p>logical indicating whether to use fuzzy-matching (based on the
<code>stringdist</code> package). Defaults to FALSE.</p></dd>


<dt>fuzzy_method</dt>
<dd><p>if <code>fuzzy = TRUE</code>, the method to use for string distance
calculation (see <a href="https://rdrr.io/pkg/stringdist/man/stringdist-metrics.html" class="external-link">stringdist-metrics</a>). Defaults to "osa".</p></dd>


<dt>fuzzy_dist</dt>
<dd><p>if <code>fuzzy = TRUE</code>, the maximum string distance to use to
classify matches (i.e. a string distance less than or equal to <code>fuzzy_dist</code>
will be considered matching). Defaults to <code>1L</code>.</p></dd>


<dt>dict</dt>
<dd><p>optional dictionary for recoding values within the hierarchical
columns of <code>raw</code> (see <a href="dictionary_recoding.html">dictionary_recoding</a>)</p></dd>


<dt>ref_prefix</dt>
<dd><p>prefix to add to names of returned columns from <code>ref</code> if
they are otherwise identical to names within <code>raw</code>. Defaults to "ref_".</p></dd>


<dt>std_fn</dt>
<dd><p>function to standardize strings during matching. Defaults to
<code><a href="string_std.html">string_std</a></code>. Set to <code>NULL</code> to omit standardization. See
also <a href="string_standardization.html">string_standardization</a>.</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed to <code>std_fn()</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a data frame obtained by matching the hierarchical columns in <code>raw</code></p>


<p>and <code>ref</code>, using the join type specified by argument <code>type</code> (see
<a href="join_types.html">join_types</a> for more details)</p>
    </div>
    <div class="section level2">
    <h2 id="resolve-joins">Resolve joins<a class="anchor" aria-label="anchor" href="#resolve-joins"></a></h2>
    

<p>In <code>hmatch</code>, if argument <code>type</code> corresponds to a resolve join, rows
of <code>raw</code> with multiple matches to <code>ref</code> are always resolved to 'no match'.
This is because <code>hmatch</code> does not accept matches below the highest
non-missing level within a given row of <code>raw</code>. E.g.</p>
<p><code>raw</code>: <br><code>1. | United States | &lt;NA&gt;         | Jefferson |</code> <br></p>
<p>Relevant rows from <code>ref</code>: <br><code>1. | United States | New York     | Jefferson |</code> <br><code>2. | United States | Pennsylvania | Jefferson |</code></p>
<p>In a regular join with <code>hmatch</code>, the single row from <code>raw</code> (above)
will match both rows of <code>ref</code>. However, in a resolve join the multiple
conflicting matches (i.e. conflicting values at the 2nd hierarchical level)
will result in the row from <code>raw</code> being treated as non-matching to <code>ref</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ne_raw</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ne_ref</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">hmatch</span><span class="op">(</span><span class="va">ne_raw</span>, <span class="va">ne_ref</span>, pattern <span class="op">=</span> <span class="st">"adm"</span>, type <span class="op">=</span> <span class="st">"inner"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      id adm0      adm1         adm2 level ref_adm0     ref_adm1     ref_adm2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 PID01  USA  New York      Suffolk  adm2      USA     New York      Suffolk</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 PID02  can   ontario         &lt;NA&gt;  adm1      CAN      Ontario         &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 PID04 &lt;NA&gt;      &lt;NA&gt; Philadelphia  adm2      USA Pennsylvania Philadelphia</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 PID05  USA      &lt;NA&gt;         York  adm2      USA Pennsylvania         York</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 PID06  USA new. york    jefferson  adm2      USA     New York    Jefferson</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 PID14 &lt;NA&gt;      &lt;NA&gt;         york  adm2      CAN      Ontario         York</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 PID14 &lt;NA&gt;      &lt;NA&gt;         york  adm2      USA Pennsylvania         York</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   hcode</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   238</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Patrick Barks.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

